package com.grocery.service;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.grocery.exception.CategoryException;
import com.grocery.exception.ProductException;
import com.grocery.model.Category;
import com.grocery.model.Product;
import com.grocery.repository.ProductRepository;

@Service
public class ProductServiceImpl implements ProductService{
	
	@Autowired
	ProductRepository pr;
	@Autowired
	CategoryService cs;

	@Override
	public Product createProduct(Product prod) throws ProductException, CategoryException {
		Category thisCategory = prod.getCategory();
		Category existingCategory = cs.findCategoryById(thisCategory.getId());
		if(existingCategory == null) {
			cs.createCategory(thisCategory);
		}
		pr.save(prod);
		return prod;
	}
	
	@Override
	public List<Product> getAllProducts() {
		return pr.findAll();
	}

	@Override
	public void deleteProduct(Long productId) throws ProductException {
		Optional<Product> prod = Optional.ofNullable(pr.findById(productId)
				.orElseThrow(()->new ProductException("Product not found for the id: "+productId)));
		pr.delete(prod.get());
	}

	@Override
	public Product updateProduct(Long productId, Product product) throws ProductException {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public Product findProductById(Long productId) throws ProductException {
		return pr.findById(productId).orElse(null);
	}
	

	
}
